\chapter{\label{impl}Технологическая часть}

\section{Выбор системы управления базами данных}

Система управления базами данных (СУБД) --- это совокупность программ и языковых
средств, предназначенных для управления данными в базе данных, ведения базы
данных и обеспечения взаимодействия ее с прикладными программами~\cite{gost01}.

В аналитической части для реализуемой системы были выбраны реляционные
базы данных, следовательно, необходимо рассмотреть СУБД, предоставляющие
возможность работы с ними:
\begin{itemize}
    \item \textbf{Microsoft SQL Server} --- реляционная система управления
        базами данных, разработанная корпорацией Microsoft, основным языком
        запросов которой является Transact-SQL~\cite{art06}. Являясь разработкой
        Microsoft имеет возможность интеграции с другими продуктами компании, в
        том числе с облачными хранилищами, а также подробную
        документацию~\cite{site10}. Однако при этом поддерживает меньшее число
        операционных систем по сравнению с другими рассматриваемыми
        СУБД~\cite{art07} и имеет высокую стоимость корпоративной
        версии~\cite{site11}.
    \item \textbf{PostgreSQL} --- это объектно-реляционная система управления
        базами данных с открытым исходным кодом, соответсвующая стандартам ANSI
        SQL~\cite{site08}.  Данная СУБД поддерживает пользовательские типы
        данных, в том числе неструктурированные (JSON и XML), а также интеграцию
        сторонних интрументов~\cite{site12}.
    \item \textbf{Oracle} --- это объектно-реляционная система управления базами
        данных, созданная корпорацией Oracle~\cite{site09}. Поддерживает работу
        с крупными БД и большим числом пользователей, имеет подробную
        документацию, однако версии без ограничения функциональностей имеют
        высокую стоимость~\cite{site13}.
    \item \textbf{MySQL} --- это бесплатная реляционная система управления
        базами данных, разработку и поддержку которой осуществляет корпорация
        Oracle~\cite{art06}.  Хотя и распроняется бесплатно имеет платную
        поддержку, и неполностью соответсвует стандартам~SQL~\cite{site12}.
\end{itemize}

\subsection{Сравнение описанных СУБД}

Основными критериями для выбора СУБД являются:
\begin{itemize}
    \item \textbf{К1} --- бесплатное распространение (логический критерий);
    \item \textbf{К2} --- подробная открытая документация (логический критерий);
    \item \textbf{К3} --- производительность (рейтинг на основе
        источника~\cite{art08}).
\end{itemize}

Сравнение СУБД по этим критериям приведено в таблице~\ref{tab:02}.

\begin{table}[ht!]
\captionsetup{format=hang,justification=raggedright,
              singlelinecheck=off,width=9cm}
\centering
\caption{Сравнение СУБД\label{tab:02}}
\begin{tabular}[Hc]{|p{5cm}|c|c|c|}
    \hline
    \multicolumn{1}{|c}{\textbf{Решение}} & \multicolumn{1}{|c|}{\textbf{K1}} &
    \multicolumn{1}{c|}{\textbf{K2}} & \multicolumn{1}{c|}{\textbf{K3}}\\
    \hline
    \mbox{Microsoft SQL Server}  & - & + & 3\\
    \hline                                                           
    \mbox{PostgreSQL}            & + & + & 1\\
    \hline                                                           
    \mbox{Oracle}                & - & + & 2\\
    \hline                                                           
    \mbox{MySQL}                 & + & - & 4\\
    \hline
\end{tabular}
\end{table}

\subsection*{Вывод}

Для решения задачи была выбрана система управления базами данных
PostgreSQL, так как она:

\begin{itemize}
    \item наиболее производительна из рассматриваемых СУБД;
    \item имеет открытый исходный код;
    \item имеет подробную открытую документацию.
\end{itemize}

\section{Выбор средств реализации приложения}

Для реализации приложения выбран язык C\#~\cite{site14}, так как он поддерживает
принципы ООП, на которых основана структура разрабатываемого программного
обеспечения. 

Для реализации компонента доступа к базе данных выбран Entity
Framework~\cite{site15}, позволяющий автоматизировать процесс создания базы
данных и ее таблиц, а также поддерживающий работу с многими СУБД, в том числе и
PostgreSQL.

Для реализации web-интерфейса выбран фреймворк Blazor~\cite{site16} и библиотека
компонентов Blazorise~\cite{site17}, для быстрой разработки интерфейса.

В качестве среды разработки выбрана Visual Studio~\cite{site18}, так как она
поддерживает работу со всеми выше описанными средствами в том числе и их
установку, а также обладает встроенными средствами тестирования и отладки.

\section{Детали реализации}

\subsection{Создание таблиц}

Создание таблиц базы данных и соответствующих ограничений полей представленно на
листингах~\ref{lst:venues}-\ref{lst:roles}.

{
\captionsetup{format=hang,justification=raggedright,
              singlelinecheck=off,width=16cm}
\listingfile{sql}{venueTable.sql}{}{Создание таблицы мест проведения}{venues}

\listingfile{sql}{organizerTable.sql}{}{Создание таблицы организаторов}{orgs}

\listingfile{sql}{playerTable.sql}{}{Создание таблицы игроков}{players}
\clearpage

\listingfile{sql}{eventTable.sql}{}{Создание таблицы игротек}{events}

\listingfile{sql}{regTable.sql}{}{Создание таблицы связи игротек и
игроков}{regs}

\clearpage
\listingfile{sql}{gameTable.sql}{}{Создание таблицы игр}{games}

\listingfile{sql}{eventGameTable.sql}{}{Создание таблицы связи игр и
игротек}{egrs}

\listingfile{sql}{favTable.sql}{}{Создание таблицы связи игр и игроков}{favs}

\clearpage
\listingfile{sql}{userTable.sql}{}{Создание таблицы пользователей}{users}

\listingfile{sql}{roleTable.sql}{}{Создание таблицы ролей}{roles}

}

\subsection{Создание ролей}

Создание ролей Гостя, Игрока, Организатора и Администратора представлены на
листингах~\ref{lst:guest},~\ref{lst:player},~\ref{lst:org},~\ref{lst:admin}
соответсвтвенно.

{
\captionsetup{format=hang,justification=raggedright,
              singlelinecheck=off,width=16cm}
\listingfile{sql}{guestRole.sql}{}{Создание роли гостя}{guest}
\listingfile{sql}{playerRole.sql}{}{Создание роли игрока}{player}
\listingfile{sql}{orgRole.sql}{}{Создание роли организатора}{org}
\listingfile{sql}{adminRole.sql}{}{Создание роли администратора}{admin}
}

\clearpage
\subsection{Создание хранимых процедур и функций}

Создание функции получения соостояния игротеки представлено на
листинге~\ref{lst:state}, процедура обновления списка игр, по которым проводится
игротека, представлена на листинге~\ref{lst:egUpdate}.

{
\captionsetup{format=hang,justification=raggedright,
              singlelinecheck=off,width=16cm}
\listingfile{sql}{eventState.sql}{lastline=33}{Функция получение состояния
игротеки}{state}
\listingfile{sql}{eventGames.sql}{lastline=14}{Процедура обновления игр
игротеки}{egUpdate}
}

\subsection{Создание триггеров}

Триггер <<BEFORE INSERT>> на таблице Registrations, реализующий проверку времени
регистрации на игротеку представлен на листинге~\ref{lst:trig}.

{
\captionsetup{format=hang,justification=raggedright,
              singlelinecheck=off,width=16cm}
\listingfile{sql}{registrationsTrigger.sql}{}{Триггер проверки завершения
времени регистрации на игротеку}{trig}
}

\section{Пример работы программы}

Начальная страница приложения представлена на рисунке~\ref{img:begin}. Эту
страницу видит гость при открытии приложения, на нее происходит переход при
входе, регистрации и смене роли пользователя с игрока на организатора и
наоборот.

Неавторизованный пользователь имеет доступ к спискам
игротек~(рисунок~\ref{img:events}) и настольных игр~(рисунок~\ref{img:games}),
также предоставляется доступ к просмотру полной информации о конкретной игротеке
или игре на отдельных страницах. К этим страницам имеют доступ и пользователи с
другими ролями. На странице игротеки гостю доступно нажатие на кнопку
<<Зарегистрироваться>> (если регистрация на игротеку идет), но при нажатии на
нее отображается всплывающее окно с предложением зарегистрироваться или
войти~\ref{img:guestReg}.

Гостю также предлагается возможность входа и регистрации. Соответствующие формы
представлены на рисунках~\ref{img:login},~\ref{img:reg}. При вводе в поля форм
осуществляется валидация введенных данных, ее пример представлен на
рисунке~\ref{img:valid}.

При успешном входе или регистрации пользователю выдается базовая роль игрока.
Игрок имеет возможность зарегистрироваться на игроку нажатием на кнопку
<<Зарегистрироваться>> на странице игротеки и получить
подтверждение~(рисунок~\ref{regConf}). После чего имеет возможность отменить
регистрацию нажатием на кнопку <<Отменить>>. Аналогично происходит добавление
настольной игры в избранное: при посещении страницы настольной игры в роли
игрока на ней отображается кнопка добавления в
избранное~(рисунок~\ref{img:fav}). Игротеки, на которое игрок зарегистрировался
и игры, которые он добалит в избранное, игрок может посмотреть на соответсвующих
страницах, доступ к которым осуществляется через выпадающее
меню~(\ref{img:menu}). Там же пользователь может изменить роль.

Изначально у пользователя нет роли организатора, чтобы им стать игрок должен
заполнить дополнительную форму с информацией об
организаторе~(рисунок~\ref{img:orgReg}). После переключения на роль организатора
пользователь может создать свою игротеку~(рисунок~\ref{img:eventReg}), изменить
ее или отменить на странице <<Мои игротеки>>~(рисунок~\ref{img:myevents}).

Также в системе предусмотрена роль администратора. Изначально только один
пользователь имеет эту роль. Администратор имеет возможность изменять информацию
об играх и местах проведения (пример представлен на
рисунке~\ref{img:adminEdit}), выдавать и отзывать роль администратора у других
пользователей~\ref{img:adminRoles}, а также удалять их~\ref{img:adminDelete}.
Отозвать роль администратора у тогоп пользователя, который изначально имел эту
роль нельзя.

\textbf{КАРТИНКИ}
